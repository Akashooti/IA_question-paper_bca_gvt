<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Paper Generator with Logo</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .logo-preview {
        max-width: 200px;
        max-height: 100px;
        border: 1px solid #ccc;
        margin-top: 10px;
        display: none;
    }
    .file-input-wrapper {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }
    .file-input-wrapper input[type=file] {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }
</style>
</head>
<body>
  <div class="container mt-4">
    <img src="./logo.png"  height="100px"/>
    <h1 class="text-center mb-4">KLE BCA COLLEGE Gangavathi Paper Generator</h1>
    <button class="btn btn-info">DEsgined by AKASH OOTI</button>
    <!-- Logo Section -->
    <div class="card mb-4 shadow">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Logo Settings</h5>
        </div>
        <div class="card-body">
            <!-- Logo Upload -->
            <div class="mb-3">
                <label class="form-label">Choose Logo File</label>
                <div class="file-input-wrapper btn btn-primary">
                    <input type="file" id="logoFile" accept="image/*" onchange="handleLogoUpload(event)">
                    Upload Logo
                </div>
                <img id="logoPreview" class="logo-preview d-block mx-auto mt-3" alt="Logo Preview">
            </div>

            <!-- Logo Size -->
            <div class="row g-3 mb-3 align-items-end">
                <div class="col-md-6">
                    <label class="form-label">Logo Size:</label>
                    <select id="logoSize" class="form-select">
                        <option value="small">Small (20mm)</option>
                        <option value="medium" selected>Medium (30mm)</option>
                        <option value="large">Large (40mm)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label d-none" id="customSizeLabel">Custom Size (mm):</label>
                    <input type="number" id="logoCustomSize" class="form-control" placeholder="Size in mm" min="10" max="80" value="30" style="display:none;">
                </div>
            </div>

            <!-- Logo Position -->
            <div class="mb-3">
                <label class="form-label">Logo Position:</label>
                <div class="row g-2">
                    <div class="col-4">
                        <button type="button" class="btn btn-outline-primary btn-sm w-100 position-btn" data-position="header-right">Header Right</button>
                    </div>
                    <div class="col-4">
                                            <button type="button" class="btn btn-outline-primary btn-sm w-100 position-btn" data-position="header-left">Header Left</button>
                    </div>
                    <div class="col-4">
                        <button type="button" class="btn btn-outline-success btn-sm w-100 position-btn" data-position="left-right">Left & Right</button>
                    </div>
                    <div class="col-4">
                        <button type="button" class="btn btn-outline-success btn-sm w-100 position-btn" data-position="center-sides">Center Sides</button>
                    </div>
                </div>
            </div>

            <!-- Second Logo Upload -->
            <div class="mt-3" id="secondLogoSection" style="display:none;">
                <label class="form-label">Second Logo (for Left & Right position):</label>
                <div class="file-input-wrapper btn btn-success">
                    <input type="file" id="logoFile2" accept="image/*" onchange="handleSecondLogoUpload(event)">
                    Upload Second Logo
                </div>
                <img id="logoPreview2" class="logo-preview d-block mx-auto mt-3" alt="Second Logo Preview">
            </div>
        </div>
    </div>
</div>


      <!-- Paper Details -->
<div class="card mb-4 shadow">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">Paper Details</h5>
  </div>
  <div class="card-body row g-3">
    <div class="col-md-6">
      <input type="text" class="form-control" id="collegeName" placeholder="College Name" value="K.L.E Society's">
    </div>
    <div class="col-md-6">
      <input type="text" class="form-control" id="department" placeholder="Department" value="Bachelor of Computer Applications">
    </div>
    <div class="col-md-6">
      <input type="text" class="form-control" id="locationText" placeholder="Location" value="Waddarahatti, Gangavathi-583235">
    </div>
    <div class="col-md-6">
      <input type="text" class="form-control" id="classText" placeholder="Class" value="BCA 1ST Sem">
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" id="examType" placeholder="Exam Type" value="IA-2">
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" id="subject" placeholder="Subject" value="Sub:">
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" id="date" placeholder="Date" value="Date:">
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" id="time" placeholder="Time" value="Time:">
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" id="totalMarks" placeholder="Total Marks" value="40">
    </div>
  </div>
</div>

<!-- Section I -->
<div class="card mb-4 shadow">
  <div class="card-header bg-success text-white">
    <h5 class="mb-0">Section I</h5>
  </div>
  <div class="card-body">
    <input type="text" class="form-control mb-3" id="section1_title" placeholder="Section I Title"
      value="Answer ALL questions (6 √ó 2 = 12 marks)">
    <textarea class="form-control mb-2" id="q1_1" rows="2">Define Computer Science.</textarea>
    <textarea class="form-control mb-2" id="q1_2" rows="2">What is an Algorithm?</textarea>
    <textarea class="form-control mb-2" id="q1_3" rows="2">Explain the term "Data Structure".</textarea>
    <textarea class="form-control mb-2" id="q1_4" rows="2">Define Programming Language.</textarea>
    <textarea class="form-control mb-2" id="q1_5" rows="2">What is Software Engineering?</textarea>
    <textarea class="form-control" id="q1_6" rows="2">Explain Database Management System.</textarea>
  </div>
</div>

<!-- Section II -->
<div class="card mb-4 shadow">
  <div class="card-header bg-warning text-dark">
    <h5 class="mb-0">Section II</h5>
  </div>
  <div class="card-body">
    <input type="text" class="form-control mb-3" id="section2_title" placeholder="Section II Title"
      value="Answer ANY FIVE questions (5 √ó 4 = 20 marks)">
    <textarea class="form-control mb-2" id="q2_1" rows="3">Explain the different types of computer networks.</textarea>
    <textarea class="form-control mb-2" id="q2_2" rows="3">Describe the software development life cycle.</textarea>
    <textarea class="form-control mb-2" id="q2_3" rows="3">What are the advantages of object-oriented programming?</textarea>
    <textarea class="form-control mb-2" id="q2_4" rows="3">Explain the concept of normalization in databases.</textarea>
    <textarea class="form-control" id="q2_5" rows="3">Describe different sorting algorithms with examples.</textarea>
  </div>
</div>

<!-- Section III -->
<div class="card mb-4 shadow">
  <div class="card-header bg-danger text-white">
    <h5 class="mb-0">Section III</h5>
  </div>
  <div class="card-body">
    <input type="text" class="form-control mb-3" id="section3_title" placeholder="Section III Title"
      value="Answer ANY TWO questions (2 √ó 4 = 8 marks)">
    <textarea class="form-control mb-3" id="q3_1" rows="4">Discuss the evolution of computer systems and their impact on society.</textarea>
    <textarea class="form-control" id="q3_2" rows="4">Analyze the role of artificial intelligence in modern computing applications.</textarea>
  </div>
</div>


        <!-- Action Buttons -->
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="generatePortraitPreview()">üëÅÔ∏è Preview Portrait</button>
            <button class="btn btn-warning" onclick="downloadPortraitPDF()">üìÑ Download Portrait PDF</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Global variables for logo
        let logoImage = null;
        let logoImage2 = null;
        let logoPosition = 'top-right';
        let logoSize = 'medium';

        // Initialize logo position buttons
       document.addEventListener('DOMContentLoaded', function() {
    const positionBtns = document.querySelectorAll('.position-btn');
    const secondLogoSection = document.getElementById('secondLogoSection');
    
    positionBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            positionBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            logoPosition = this.dataset.position;
            
            // Show/hide second logo section
            if (logoPosition === 'left-right' || logoPosition === 'center-sides') {
                secondLogoSection.style.display = 'block';
            } else {
                secondLogoSection.style.display = 'none';
            }
        });
    });
});


            function handleSecondLogoUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            logoImage2 = e.target.result;
            const preview = document.getElementById('logoPreview2');
            preview.src = logoImage2;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}


            // Logo size dropdown change handler
            document.getElementById('logoSize').addEventListener('change', function() {
                logoSize = this.value;
                const customSizeInput = document.getElementById('logoCustomSize');
                if (this.value === 'custom') {
                    customSizeInput.style.display = 'block';
                } else {
                    customSizeInput.style.display = 'none';
                }
            });
    

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoImage = e.target.result;
                    const preview = document.getElementById('logoPreview');
                    preview.src = logoImage;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

       function getLogoSize() {
    const sizeSelect = document.getElementById('logoSize').value;
    const customSize = parseInt(document.getElementById('logoCustomSize').value);

    switch (sizeSelect) {
        case 'small': return 20;
        case 'medium': return 30;
        case 'large': return 40;
        case 'custom': return isNaN(customSize) ? 30 : customSize;
        default: return 30;
    }
}

function addLogoToPDF(doc, pageWidth, pageHeight, margin, headerEndY) {
    if (!logoImage) return headerEndY;

    const logoSizeMM = getLogoSize();
    let logoX, logoY, logoX2, logoY2;

    // Calculate logo positions
    switch (logoPosition) {
        case 'top-left':
            logoX = margin;
            logoY = margin;
            break;
        case 'top-center':
            logoX = (pageWidth - logoSizeMM) / 2;
            logoY = margin;
            break;
        case 'top-right':
            logoX = pageWidth - margin - logoSizeMM;
            logoY = margin;
            break;
        case 'header-left':
            logoX = margin;
            logoY = headerEndY - logoSizeMM - 5;
            break;
        case 'header-center':
            logoX = (pageWidth - logoSizeMM) / 2;
            logoY = headerEndY - logoSizeMM - 5;
            break;
        case 'header-right':
            logoX = pageWidth - margin - logoSizeMM;
            logoY = headerEndY - logoSizeMM - 5;
            break;
        case 'left-right':
            // Left logo
            logoX = margin;
            logoY = margin;
            // Right logo
            logoX2 = pageWidth - margin - logoSizeMM;
            logoY2 = margin;
            break;
        case 'center-sides':
            // Left of center
            logoX = pageWidth / 2 - logoSizeMM - 10;
            logoY = headerEndY - logoSizeMM - 5;
            // Right of center
            logoX2 = pageWidth / 2 + 10;
            logoY2 = headerEndY - logoSizeMM - 5;
            break;
    }

    try {
        // ‚úÖ Validate and add main logo
        if (logoImage && isFinite(logoX) && isFinite(logoY)) {
            doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
        } else {
            console.warn('Skipped main logo due to invalid coordinates or missing image');
        }

        // ‚úÖ Validate and add second logo if needed
        if ((logoPosition === 'left-right' || logoPosition === 'center-sides') && isFinite(logoX2) && isFinite(logoY2)) {
            const secondImage = logoImage2 || logoImage;
            if (secondImage) {
                doc.addImage(secondImage, 'JPEG', logoX2, logoY2, logoSizeMM, logoSizeMM);
            } else {
                console.warn('Second logo not found or invalid');
            }
        }
    } catch (error) {
        console.warn('Failed to add logo(s):', error);
    }

    // Return adjusted Y position
    const maxY = Math.max(headerEndY, (logoY || 0) + logoSizeMM + 5);
    return maxY;
}

async function downloadPortraitPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('portrait', 'mm', 'a4');
    
    const collegeName = safeGetValue('collegeName', 'K.L.E Society\'s');
    const department = safeGetValue('department', 'Bachelor of Computer Applications');
    const location = safeGetValue('locationText', 'Waddarahatti, Gangavathi-583235');
    const classText = safeGetValue('classText', 'BCA 1ST Sem');
    const examType = safeGetValue('examType', 'IA-2');
    const subject = safeGetValue('subject', 'Sub:');
    const date = safeGetValue('date', 'Date:');
    const time = safeGetValue('time', 'Time:');
    const totalMarks = safeGetValue('totalMarks', '40');
    
    const pageWidth = 210;
    const pageHeight = 297;
    const margin = 8;
    const centerX = pageWidth / 2;
    
    function generatePortraitPaper(startY, isSecondPaper = false) {
        let currentY = startY;
        
        // Header - College Name
        doc.setFontSize(15);
        doc.setFont(undefined, 'bold');
        doc.text(collegeName, centerX, currentY, { align: 'center' });
        currentY += 6;
        
        // Department
        doc.setFontSize(12);
        doc.text(department, centerX, currentY, { align: 'center' });
        currentY += 5;
        
        // Location
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        doc.text(location, centerX, currentY, { align: 'center' });
        currentY += 5;
        
        // Add logo after header - FIXED FOR SECOND PAPER
        if (isSecondPaper && logoImage) {
            const logoSizeMM = getLogoSize();
            let logoX, logoY;
            
            switch (logoPosition) {
                case 'top-left':
                    logoX = margin;
                    logoY = startY + 5;
                    break;
                case 'top-center':
                    logoX = (pageWidth - logoSizeMM) / 2;
                    logoY = startY + 5;
                    break;
                case 'top-right':
                    logoX = pageWidth - margin - logoSizeMM;
                    logoY = startY + 5;
                    break;
                case 'header-left':
                    logoX = margin;
                    logoY = currentY - logoSizeMM - 0;
                    break;
                case 'header-center':
                    logoX = (pageWidth - logoSizeMM) / 2;
                    logoY = currentY - logoSizeMM - 5;
                    break;
                case 'header-right':
                    logoX = pageWidth - margin - logoSizeMM;
                    logoY = currentY - logoSizeMM - 0;
                    break;
                case 'left-right':
                    // Left logo
                    logoX = margin;
                    logoY = startY + 5;
                    doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
                    // Right logo
                    const secondImage = logoImage2 || logoImage;
                    if (secondImage) {
                        doc.addImage(secondImage, 'JPEG', pageWidth - margin - logoSizeMM, startY + 5, logoSizeMM, logoSizeMM);
                    }
                    currentY = Math.max(currentY, startY + 5 + logoSizeMM + 5);
                    break;
                case 'center-sides':
                    logoX = pageWidth / 2 - logoSizeMM - 10;
                    logoY = currentY - logoSizeMM - 5;
                    doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
                    const secondImage2 = logoImage2 || logoImage;
                    if (secondImage2) {
                        doc.addImage(secondImage2, 'JPEG', pageWidth / 2 + 10, logoY, logoSizeMM, logoSizeMM);
                    }
                    currentY = Math.max(currentY, logoY + logoSizeMM + 5);
                    break;
            }
            
            if (logoPosition !== 'left-right' && logoPosition !== 'center-sides') {
                doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
                currentY = Math.max(currentY, logoY + logoSizeMM + 5);
            }
        } else {
            currentY = addLogoToPDF(doc, pageWidth, pageHeight, margin, currentY);
        }
        
        // Class, Exam Type, Subject line
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.text(`Class: ${classText}`, margin, currentY);
        doc.text(examType, centerX, currentY, { align: 'center' });
        doc.text(subject, pageWidth - margin, currentY, { align: 'right' });
        currentY += 4;
        
        // Date, Time, Marks line
        doc.text(date, margin, currentY);
        doc.text(time, centerX, currentY, { align: 'center' });
        doc.text(`Marks: ${totalMarks}`, pageWidth - margin, currentY, { align: 'right' });
        currentY += 4;
        
        // Horizontal line separator
        doc.setLineWidth(0.5);
        doc.line(margin, currentY, pageWidth - margin, currentY);
        currentY += 5;
        
        // Generate sections
        currentY = generatePortraitSection(doc, margin, currentY, 'I');
        currentY += 4;
        currentY = generatePortraitSection(doc, margin, currentY, 'II');
        currentY += 4;
        currentY = generatePortraitSection(doc, margin, currentY, 'III');
        
        return currentY + 5;
    }
    
    function generatePortraitSection(doc, margin, startY, sectionNum) {
        let currentY = startY;
        
        // Section header
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        let sectionTitle = '';
        if (sectionNum === 'I') {
            sectionTitle = safeGetValue('section1_title', 'I. Answer ALL questions (6 √ó 2 = 12 marks)');
        } else if (sectionNum === 'II') {
            sectionTitle = safeGetValue('section2_title', 'II. Answer ANY FIVE questions (5 √ó 4 = 20 marks)');
        } else if (sectionNum === 'III') {
            sectionTitle = safeGetValue('section3_title', 'III. Answer ANY TWO questions (2 √ó 4 = 8 marks)');
        }
        doc.text(sectionTitle, margin, currentY);
        currentY += 5;
        
        // Generate questions
        doc.setFont(undefined, 'normal');
        doc.setFontSize(9);
        
        let questions = [];
        if (sectionNum === 'I') {
            questions = [
                safeGetValue('q1_1', 'Define Computer Science.'),
                safeGetValue('q1_2', 'What is an Algorithm?'),
                safeGetValue('q1_3', 'Explain the term "Data Structure".'),
                safeGetValue('q1_4', 'Define Programming Language.'),
                safeGetValue('q1_5', 'What is Software Engineering?'),
                safeGetValue('q1_6', 'Explain Database Management System.')
            ];
        } else if (sectionNum === 'II') {
            questions = [
                safeGetValue('q2_1', 'Explain the different types of computer networks.'),
                safeGetValue('q2_2', 'Describe the software development life cycle.'),
                safeGetValue('q2_3', 'What are the advantages of object-oriented programming?'),
                safeGetValue('q2_4', 'Explain the concept of normalization in databases.'),
                safeGetValue('q2_5', 'Describe different sorting algorithms with examples.')
            ];
        } else if (sectionNum === 'III') {
            questions = [
                safeGetValue('q3_1', 'Discuss the evolution of computer systems and their impact on society.'),
                safeGetValue('q3_2', 'Analyze the role of artificial intelligence in modern computing applications.')
            ];
        }
        
        for (let i = 0; i < questions.length; i++) {
            let questionText = questions[i].replace(/^\d+\.\s*/, '');
            const questionNumber = (i + 1) + '. ';
            const fullText = questionNumber + questionText;
            
            const maxWidth = pageWidth - margin - 10;
            const lines = doc.splitTextToSize(fullText, maxWidth);
            
            for (let j = 0; j < lines.length; j++) {
                doc.text(lines[j], margin + 5, currentY);
                currentY += 4;
            }
            currentY += 2;
        }
        
        return currentY;
    }
    
    // Generate first paper
    const firstPaperEnd = generatePortraitPaper(10, false);
    
    const dividerY = Math.min(pageHeight / 2 - 2, firstPaperEnd + 2);
    
    // Add divider
    doc.setLineWidth(1);
    doc.setDrawColor(0, 0, 0);
    doc.line(margin, dividerY, pageWidth - margin, dividerY);
    doc.setFontSize(10);
    doc.text('‚úÇ', centerX - 2, dividerY - 0);
    
    // Generate second paper
    generatePortraitPaper(dividerY + 5, true);
    
    doc.save("question-paper-with-logo.pdf");
}

// Add this function to your JavaScript code before it's called
function safeGetValue(elementId, defaultValue = '') {
    const element = document.getElementById(elementId);
    if (element) {
        // Handle different input types
        if (element.type === 'checkbox' || element.type === 'radio') {
            return element.checked;
        } else if (element.tagName === 'SELECT') {
            return element.value || defaultValue;
        } else if (element.type === 'number') {
            return parseFloat(element.value) || 0;
        } else {
            return element.value || defaultValue;
        }
    }
    return defaultValue;
}

// Alternative version if you're using querySelector instead of getElementById
function safeGetValueBySelector(selector, defaultValue = '') {
    const element = document.querySelector(selector);
    if (element) {
        if (element.type === 'checkbox' || element.type === 'radio') {
            return element.checked;
        } else if (element.tagName === 'SELECT') {
            return element.value || defaultValue;
        } else if (element.type === 'number') {
            return parseFloat(element.value) || 0;
        } else {
            return element.value || defaultValue;
        }
    }
    return defaultValue;
}
function generatePortraitPreview() {
    const { jsPDF } = window.jspdf;
    if (!jsPDF) {
        console.error('jsPDF library not found');
        alert('PDF library not loaded. Please refresh the page.');
        return;
    }
    
    const doc = new jsPDF('portrait', 'mm', 'a4');
    
    const collegeName = safeGetValue('collegeName', 'K.L.E Society\'s');
    const department = safeGetValue('department', 'Bachelor of Computer Applications');
    const location = safeGetValue('locationText', 'Waddarahatti, Gangavathi-583235');
    const classText = safeGetValue('classText', 'BCA 1ST Sem');
    const examType = safeGetValue('examType', 'IA-2');
    const subject = safeGetValue('subject', 'Sub:');
    const date = safeGetValue('date', 'Date:');
    const time = safeGetValue('time', 'Time:');
    const totalMarks = safeGetValue('totalMarks', '40');
    
    const pageWidth = 210;
    const pageHeight = 297;
    const margin = 8;
    const centerX = pageWidth / 2;
    
    function generatePortraitPaper(startY, isSecondPaper = false) {
        let currentY = startY;
        
        // Header - College Name
        doc.setFontSize(15);
        doc.setFont(undefined, 'bold');
        doc.text(collegeName, centerX, currentY, { align: 'center' });
        currentY += 6;
        
        // Department
        doc.setFontSize(12);
        doc.text(department, centerX, currentY, { align: 'center' });
        currentY += 5;
        
        // Location
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        doc.text(location, centerX, currentY, { align: 'center' });
        currentY += 5;
        
        // Add logo after header - FIXED FOR SECOND PAPER
        if (isSecondPaper && logoImage) {
            const logoSizeMM = getLogoSize();
            let logoX, logoY;
            
            switch (logoPosition) {
                case 'top-left':
                    logoX = margin;
                    logoY = startY + 5;
                    break;
                case 'top-center':
                    logoX = (pageWidth - logoSizeMM) / 2;
                    logoY = startY + 5;
                    break;
                case 'top-right':
                    logoX = pageWidth - margin - logoSizeMM;
                    logoY = startY + 5;
                    break;
                case 'header-left':
                    logoX = margin;
                    logoY = currentY - logoSizeMM - 5;
                    break;
                case 'header-center':
                    logoX = (pageWidth - logoSizeMM) / 2;
                    logoY = currentY - logoSizeMM - 5;
                    break;
                case 'header-right':
                    logoX = pageWidth - margin - logoSizeMM;
                    logoY = currentY - logoSizeMM - 5;
                    break;
                case 'left-right':
                    // Left logo
                    logoX = margin;
                    logoY = startY + 5;
                    doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
                    // Right logo
                    const secondImage = logoImage2 || logoImage;
                    if (secondImage) {
                        doc.addImage(secondImage, 'JPEG', pageWidth - margin - logoSizeMM, startY + 5, logoSizeMM, logoSizeMM);
                    }
                    currentY = Math.max(currentY, startY + 5 + logoSizeMM + 5);
                    break;
                case 'center-sides':
                    logoX = pageWidth / 2 - logoSizeMM - 10;
                    logoY = currentY - logoSizeMM - 5;
                    doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
                    const secondImage2 = logoImage2 || logoImage;
                    if (secondImage2) {
                        doc.addImage(secondImage2, 'JPEG', pageWidth / 2 + 10, logoY, logoSizeMM, logoSizeMM);
                    }
                    currentY = Math.max(currentY, logoY + logoSizeMM + 5);
                    break;
            }
            
            if (logoPosition !== 'left-right' && logoPosition !== 'center-sides') {
                doc.addImage(logoImage, 'JPEG', logoX, logoY, logoSizeMM, logoSizeMM);
                currentY = Math.max(currentY, logoY + logoSizeMM + 5);
            }
        } else {
            currentY = addLogoToPDF(doc, pageWidth, pageHeight, margin, currentY);
        }
        
        // Class, Exam Type, Subject line
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.text(`Class: ${classText}`, margin, currentY);
        doc.text(examType, centerX, currentY, { align: 'center' });
        doc.text(subject, pageWidth - margin, currentY, { align: 'right' });
        currentY += 4;
        
        // Date, Time, Marks line
        doc.text(date, margin, currentY);
        doc.text(time, centerX, currentY, { align: 'center' });
        doc.text(`Marks: ${totalMarks}`, pageWidth - margin, currentY, { align: 'right' });
        currentY += 4;
        
        // Horizontal line separator
        doc.setLineWidth(0.5);
        doc.line(margin, currentY, pageWidth - margin, currentY);
        currentY += 5;
        
        // Generate sections
        currentY = generatePortraitSection(doc, margin, currentY, 'I');
        currentY += 2;
        currentY = generatePortraitSection(doc, margin, currentY, 'II');
        currentY += 2;
        currentY = generatePortraitSection(doc, margin, currentY, 'III');
        
        return currentY + 5;
    }
    
    function generatePortraitSection(doc, margin, startY, sectionNum) {
        let currentY = startY;
        
        // Section header
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        let sectionTitle = '';
        if (sectionNum === 'I') {
            sectionTitle = safeGetValue('section1_title', 'I. Answer ALL questions (6 √ó 2 = 12 marks)');
        } else if (sectionNum === 'II') {
            sectionTitle = safeGetValue('section2_title', 'II. Answer ANY FIVE questions (5 √ó 4 = 20 marks)');
        } else if (sectionNum === 'III') {
            sectionTitle = safeGetValue('section3_title', 'III. Answer ANY TWO questions (2 √ó 4 = 8 marks)');
        }
        doc.text(sectionTitle, margin, currentY);
        currentY += 5;
        
        // Generate questions
        doc.setFont(undefined, 'normal');
        doc.setFontSize(9);
        
        let questions = [];
        if (sectionNum === 'I') {
            questions = [
                safeGetValue('q1_1', 'Define Computer Science.'),
                safeGetValue('q1_2', 'What is an Algorithm?'),
                safeGetValue('q1_3', 'Explain the term "Data Structure".'),
                safeGetValue('q1_4', 'Define Programming Language.'),
                safeGetValue('q1_5', 'What is Software Engineering?'),
                safeGetValue('q1_6', 'Explain Database Management System.')
            ];
        } else if (sectionNum === 'II') {
            questions = [
                safeGetValue('q2_1', 'Explain the different types of computer networks.'),
                safeGetValue('q2_2', 'Describe the software development life cycle.'),
                safeGetValue('q2_3', 'What are the advantages of object-oriented programming?'),
                safeGetValue('q2_4', 'Explain the concept of normalization in databases.'),
                safeGetValue('q2_5', 'Describe different sorting algorithms with examples.')
            ];
        } else if (sectionNum === 'III') {
            questions = [
                safeGetValue('q3_1', 'Discuss the evolution of computer systems and their impact on society.'),
                safeGetValue('q3_2', 'Analyze the role of artificial intelligence in modern computing applications.')
            ];
        }
        
        for (let i = 0; i < questions.length; i++) {
            let questionText = questions[i].replace(/^\d+\.\s*/, '');
            const questionNumber = (i + 1) + '. ';
            const fullText = questionNumber + questionText;
            
            const maxWidth = pageWidth - margin - 10;
            const lines = doc.splitTextToSize(fullText, maxWidth);
            
            for (let j = 0; j < lines.length; j++) {
                doc.text(lines[j], margin + 5, currentY);
                currentY += 4;
            }
            currentY += 2;
        }
        
        return currentY;
    }
    
    // Generate first paper
    const firstPaperEnd = generatePortraitPaper(10, false);
    
    const dividerY = Math.min(pageHeight / 2 - 2, firstPaperEnd + 2);
    
    // Add divider
    doc.setLineWidth(1);
    doc.setDrawColor(0, 0, 0);
    doc.line(margin, dividerY, pageWidth - margin, dividerY);
    doc.setFontSize(10);
    doc.text('‚úÇ', centerX - 2, dividerY - 1);
    
    // Generate second paper
    generatePortraitPaper(dividerY + 10, true);
    
    // Open preview in new tab
    const pdfBlob = doc.output('blob');
    const pdfUrl = URL.createObjectURL(pdfBlob);
    window.open(pdfUrl, '_blank');
}
    </script>
</body>
</html>
